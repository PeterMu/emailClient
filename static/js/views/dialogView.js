// Generated by CoffeeScript 1.7.1
(function() {
  define(function(require, exports, module) {
    var $, Backbone, Dialog, Mustache, dialogItem;
    $ = require('jquery');
    Mustache = require('mustache');
    Backbone = require('backbone');
    Dialog = require('../models/dialog');
    dialogItem = Backbone.View.extend({
      initialize: function() {
        return this.model.on('distroy', this.removeDom, this);
      },
      events: {
        'click .show-more': 'showMore',
        'click .fa-reply': 'reply'
      },
      template: function() {
        if (this.model.get('type') === 'from') {
          return Mustache.render($('#dialog-from-tpl').text(), this.model.toJSON());
        } else {
          return Mustache.render($('#dialog-to-tpl').text(), this.model.toJSON());
        }
      },
      render: function() {
        var width;
        this.$el.html(this.template());
        if (this.model.get('type') === 'to') {
          width = $(window).outerWidth() - 1320;
          if (width < 0) {
            this.$('.item-to').css('left', '30px');
          } else {
            this.$('.item-to').css('left', width);
          }
        }
        return this;
      },
      showMore: function() {
        var fa;
        fa = this.$('.show-more').find('.fa');
        if (fa.hasClass('fa-angle-down')) {
          fa.removeClass('fa-angle-down').addClass('fa-angle-up');
          return this.$('.dialog-article').css({
            'max-height': '100%'
          });
        } else {
          fa.removeClass('fa-angle-up').addClass('fa-angle-down');
          return this.$('.dialog-article').css({
            'max-height': '200px'
          });
        }
      },
      reply: function() {
        var $reply;
        $reply = $('.quick-reply');
        $reply.css('bottom', '-20px');
        $reply.find('input').val('Re: ' + this.model.get('subject'));
        return $reply.find('textarea').focus();
      },
      removeDom: function() {
        return this.$el.remove();
      }
    });
    return module.exports = Backbone.View.extend({
      el: $('#dialog-list'),
      events: {
        'click h4': this.test
      },
      initialize: function() {
        var that;
        that = this;
        this.collection = new Dialog.collection;
        this.collection.on('reset', this.renderAll, this);
        this.on('loadDialog', function(address) {
          return that.pullData(address);
        });
        this.collection.on('add', this.renderOne, this);
        return this.collection.on('remove', this.removeDialog, this);
      },
      renderOne: function(model) {
        var item;
        item = new dialogItem({
          model: model
        });
        return this.$el.append(item.render().el);
      },
      renderAll: function() {
        this.$el.children().remove();
        return this.collection.each(this.renderOne, this);
      },
      pullData: function(address) {
        return this.collection.pull(address);
      },
      removeDialog: function(model) {
        return model.distroy();
      }
    });
  });

}).call(this);
